{"remainingRequest":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/babel-loader/lib/index.js!/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/AmineOmz/Bureau/T_DOP_700/front_aut/src/pages/UserProfile/EditProfileForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/src/pages/UserProfile/EditProfileForm.vue","mtime":1569853943775},{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport axios from 'axios';\nimport Swal from 'sweetalert2';\nimport jwt_decode from 'jwt-decode';\nimport router from \"../../router/index\";\nexport default {\n  name: \"EditProfileForm\",\n  props: {\n    dataBackgroundColor: {\n      type: String,\n      default: \"\"\n    }\n  },\n  data: function data() {\n    return {\n      errors: [],\n      currentUser: {},\n      user: {},\n      id: null,\n      lastname: null,\n      firstname: null,\n      email: null,\n      password: null,\n      created_at: null,\n      updated_at: null,\n      confirm_password: null,\n      canEdit: false\n    };\n  },\n  created: function created() {\n    this.fetchData();\n  },\n  methods: {\n    fetchData: function fetchData() {\n      var _this = this;\n\n      axios.get('https://timepool.me:3001/api/users/' + jwt_decode(localStorage.getItem('token')).id, {\n        headers: {\n          Authorization: 'Bearer ' + localStorage.getItem('token')\n        }\n      }).then(function (response) {\n        _this.currentUser = response.data;\n        _this.firstname = _this.currentUser.first_name;\n        _this.lastname = _this.currentUser.last_name;\n        _this.email = _this.currentUser.email;\n        _this.password = _this.currentUser.password;\n        _this.updated_at = _this.currentUser.updatedAt;\n        _this.created_at = _this.currentUser.createdAt;\n      }).catch(function (error) {\n        console.log(error);\n      });\n    },\n    edit: function edit() {\n      var _this2 = this;\n\n      if (this.password == null) {\n        Swal.fire({\n          type: 'error',\n          title: 'Erreur',\n          text: 'Veuillez saisir le mot de passe',\n          footer: 'Merci de réessayez'\n        });\n        return;\n      }\n\n      if (this.password != null) {\n        this.user.first_name = this.firstname;\n        this.user.last_name = this.lastname;\n        this.user.password = this.password;\n        this.user.email = this.email; // ################## POST FOR GET JWT ###################\n\n        axios.post('https://timepool.me:3001/api/users/sign_in', {\n          email: this.email,\n          password: this.password\n        }, {\n          headers: {\n            Authorization: 'Bearer ' + localStorage.getItem('token')\n          }\n        }).then(function (response) {\n          if (response.data.token == null) {\n            alert('Mot de passe incorrect');\n            _this2.password = null;\n            return;\n          } else {\n            axios.put('https://timepool.me:3001/api/users/' + jwt_decode(localStorage.getItem('token')).id, _this2.user, {\n              headers: {\n                Authorization: 'Bearer ' + localStorage.getItem('token')\n              }\n            }).then(function (response) {\n              Swal.fire('Félicitation', 'Profil mis à jour!', 'success');\n              return;\n            }).catch(function (e) {\n              Swal.fire({\n                type: 'error',\n                title: 'Erreur',\n                text: 'Mise à jour du compte impossible',\n                footer: 'Merci de réessayez'\n              });\n              console.log(e);\n            });\n          }\n        }).catch(function (error) {\n          console.log(error);\n        }); // #################### END OF POST ######################\n      }\n\n      this.password = null;\n    },\n    remove: function remove() {\n      var _this3 = this;\n\n      // CAS ADMIN\n      var token = localStorage.getItem('token');\n\n      if (jwt_decode(token).id == 1) {\n        Swal.fire({\n          type: 'error',\n          title: 'Oops...',\n          text: 'Vous ne pouvez pas supprimer votre compte, vous êtes Administrateur!'\n        });\n        this.password = null;\n        return;\n      }\n\n      if (jwt_decode(token).id != 1 && this.password == null) {\n        Swal.fire({\n          type: 'error',\n          title: 'Erreur',\n          text: 'Veuillez saisir le mot de passe',\n          footer: 'Merci de réessayez'\n        });\n        return;\n      } // ############### POST TO VERIFY IF EXISTS ################\n\n\n      if (jwt_decode(token).id != 1 && this.password != null) {\n        axios.post('https://timepool.me:3001/api/users/sign_in', {\n          email: this.email,\n          password: this.password\n        }, {\n          headers: {\n            Authorization: 'Bearer ' + localStorage.getItem('token')\n          }\n        }).then(function (response) {\n          if (response.data.token == null) {\n            _this3.password = null;\n            return;\n          } else {\n            axios.delete('https://timepool.me:3001/api/users/' + jwt_decode(token).id, {\n              headers: {\n                Authorization: 'Bearer ' + token\n              }\n            }).then(function (resp) {\n              Swal.fire('Supprimé', 'Votre compte a bien été supprimé', 'success');\n              localStorage.removeItem('token');\n              router.push('/login');\n            }).catch(function (err) {\n              console.log(err);\n            });\n          }\n        }).catch(function (error) {\n          console.log(error);\n        });\n      }\n    }\n  }\n};",{"version":3,"sources":["EditProfileForm.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <form>\n    <md-card>\n      <md-card-header :data-background-color=\"dataBackgroundColor\">\n        <h4 class=\"title\">Editez votre profil</h4>\n        <p class=\"category\">Complétez votre profil</p>\n      </md-card-header>\n\n      <md-card-content>\n        <div class=\"md-layout\">\n          <div class=\"md-layout-item md-small-size-100 md-size-33\">\n            <md-field>\n              <label>Prénom</label>\n              <md-input v-model=\"firstname\" type=\"text\"></md-input>\n            </md-field>\n          </div>\n          <div class=\"md-layout-item md-small-size-100 md-size-50\">\n            <md-field>\n              <label>Nom</label>\n              <md-input v-model=\"lastname\" type=\"text\"></md-input>\n            </md-field>\n          </div>\n          <div class=\"md-layout-item md-small-size-100 md-size-100\">\n            <md-field>\n              <label>E-mail</label>\n              <md-input v-model=\"email\" type=\"text\"></md-input>\n            </md-field>\n          </div>\n          <div class=\"md-layout-item md-small-size-100 md-size-100\">\n            <md-field>\n              <label>Mot de passe</label>\n              <md-input v-model=\"password\" type=\"password\" required></md-input>\n            </md-field>\n          </div>\n          <div></div>\n          <div class=\"md-layout-item md-size-100 text-right\">\n            <md-button class=\"md-raised md-success\" v-on:click=\"edit\">Mettre à jour</md-button>\n          </div>\n          <div class=\"md-layout-item md-size-100 text-right\">\n            <md-button class=\"md-raised md-success\" v-on:click=\"remove\">Supprimer votre compte</md-button>\n          </div>\n        </div>\n      </md-card-content>\n    </md-card>\n  </form>\n</template>\n\n\n<script>\n\nimport axios from 'axios';\nimport Swal from 'sweetalert2';\nimport jwt_decode from 'jwt-decode';\nimport router from '../../router/index'\n\nexport default {\n\n  name: \"EditProfileForm\",\n\n  props: {\n    dataBackgroundColor: {\n      type: String,\n      default: \"\"\n    }\n  },\n\n  data() {\n    return {\n      errors: [],\n      currentUser: {},\n      user: {},\n      id: null,\n      lastname: null,\n      firstname: null,\n      email: null,\n      password: null,\n      created_at: null,\n      updated_at: null,\n      confirm_password: null,\n      canEdit: false,\n    };\n  },\n\n  created() {\n    this.fetchData();\n  },\n\n  methods: {\n    \n    fetchData() {\n      \n      axios.get('https://timepool.me:3001/api/users/' + jwt_decode(localStorage.getItem('token')).id, {\n        headers: {\n          Authorization: 'Bearer ' + localStorage.getItem('token')\n        }\n      })\n      .then((response) => {\n          this.currentUser = response.data;\n          this.firstname = this.currentUser.first_name;\n          this.lastname = this.currentUser.last_name;\n          this.email = this.currentUser.email;\n          this.password = this.currentUser.password;\n          this.updated_at = this.currentUser.updatedAt;\n          this.created_at = this.currentUser.createdAt;\n      })\n      .catch((error) => {\n          console.log(error);\n      })\n    },\n\n    edit() {\n\n      if (this.password == null) {\n        Swal.fire({\n          type: 'error',\n          title: 'Erreur',\n          text: 'Veuillez saisir le mot de passe',\n          footer: 'Merci de réessayez'\n        });\n        return;\n      }\n\n      if (this.password != null) {\n        this.user.first_name = this.firstname;\n        this.user.last_name = this.lastname;\n        this.user.password = this.password;\n        this.user.email = this.email;\n\n        // ################## POST FOR GET JWT ###################\n        axios.post('https://timepool.me:3001/api/users/sign_in', {email: this.email, password: this.password}, {\n          headers: {\n            Authorization: 'Bearer ' + localStorage.getItem('token')\n          }\n        })\n        .then((response) => {\n          if (response.data.token == null) {\n            alert('Mot de passe incorrect');\n            this.password = null;\n            return;\n          } else {\n            axios.put('https://timepool.me:3001/api/users/' + jwt_decode(localStorage.getItem('token')).id, this.user, {\n            headers: {\n              Authorization: 'Bearer ' + localStorage.getItem('token')\n            }\n          })\n          .then((response) => {\n            Swal.fire(\n              'Félicitation',\n              'Profil mis à jour!',\n              'success'\n            );\n            return;\n          })\n          .catch((e) => {\n            Swal.fire({\n              type: 'error',\n              title: 'Erreur',\n              text: 'Mise à jour du compte impossible',\n              footer: 'Merci de réessayez'\n            });\n            console.log(e);\n          })\n          }\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n        // #################### END OF POST ######################\n      }\n        this.password = null;   \n    },\n\n    remove() {\n      // CAS ADMIN\n      var token = localStorage.getItem('token');\n\n      if (jwt_decode(token).id == 1) {\n        Swal.fire({\n          type: 'error',\n          title: 'Oops...',\n          text: 'Vous ne pouvez pas supprimer votre compte, vous êtes Administrateur!'\n        })\n        this.password = null;\n        return;\n      }\n\n      if (jwt_decode(token).id != 1 && this.password == null) {\n        Swal.fire({\n          type: 'error',\n          title: 'Erreur',\n          text: 'Veuillez saisir le mot de passe',\n          footer: 'Merci de réessayez'\n        });\n        return;\n      }\n\n      // ############### POST TO VERIFY IF EXISTS ################\n      if (jwt_decode(token).id != 1 && this.password != null) {\n        axios.post('https://timepool.me:3001/api/users/sign_in', {email: this.email, password: this.password}, {\n          headers: {\n            Authorization: 'Bearer ' + localStorage.getItem('token')\n          }\n        })\n        .then((response) => {\n          if (response.data.token == null) {\n            this.password = null;\n            return;\n          } else {\n            axios.delete('https://timepool.me:3001/api/users/' + jwt_decode(token).id, {\n              headers: {\n                Authorization: 'Bearer ' + token\n              }\n            })\n            .then((resp) => {\n              Swal.fire(\n                'Supprimé',\n                'Votre compte a bien été supprimé',\n                'success'\n              )\n              localStorage.removeItem('token');\n              router.push('/login');\n            })\n            .catch((err) => {\n              console.log(err);\n            });\n          }\n        })\n        .catch((error) => {\n          console.log(error);\n        });\n      }\n    }\n  }\n}\n\n</script>\n"],"sourceRoot":"src/pages/UserProfile"}]}
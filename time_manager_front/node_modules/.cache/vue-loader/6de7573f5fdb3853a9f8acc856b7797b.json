{"remainingRequest":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/AmineOmz/Bureau/T_DOP_700/front_aut/src/pages/UserManager.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/src/pages/UserManager.vue","mtime":1569674824646},{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/AmineOmz/Bureau/T_DOP_700/front_aut/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport axios from 'axios';\nimport Swal from 'sweetalert2';\n\nexport default {\n    name: 'UserManager',\n\n    data() {\n        return {\n            users: [],\n            managers: [],\n            token: localStorage.getItem('token'),\n            teamName: '',\n            selected: null,\n            managerId: null,\n            team: {\n                name: '',\n                managerId: 0\n            }\n        }\n    },\n\n    created() {\n        this.getUsersAndManagers();\n    },\n\n    methods: {\n\n        selectedValue(e) {\n            this.managerId = e.target.value;\n        },\n\n        getUsersAndManagers() {\n            axios.get('http://localhost:3000/api/users', {headers: {\n                Authorization: 'Bearer ' + this.token\n            }}).then((response) => {\n                // RETRIEVE USERS\n                this.users = response.data;\n                this.users.splice(0, 1);\n                this.total = this.users.length;\n\n                // RETRIEVE MANAGERS\n                for (var i = 0; i < this.users.length; i++) {\n                    if (this.users[i].role == 'Manager') {\n                        this.managers.push(this.users[i]);\n                    }\n                }\n            }).catch((error) => {\n                console.log(error);\n            });\n        },\n\n        deleting(id) {\n            Swal.fire({\n                title: 'Êtes vous sûr de vouloir supprimer cet utilisateur ?',\n                type: 'warning',\n                showCancelButton: true,\n                confirmButtonColor: '#3085d6',\n                cancelButtonColor: '#d33',\n                confirmButtonText: 'Oui supprimer'\n                }).then((result) => {\n                if (result.value) {\n                    axios.delete('http://localhost:3000/api/users/' + id, {\n                        headers: {\n                            Authorization: 'Bearer ' + localStorage.getItem('token')\n                        }\n                    }).then(response => {\n                        this.getUsers();\n                        Swal.fire(\n                            'Supprimé!',\n                            'success'\n                        )\n                    }).catch(err => {\n                        Swal.fire({\n                            type: 'error',\n                            title: 'Erreur',\n                            text: 'Suppression impossible'\n                        })\n                        console.log(err);\n                    });\n                }\n            })\n        },\n\n        promote(id, first_name, role) {\n            if (role == 'Manager') {\n                Swal.fire({\n                    type: 'error',\n                    title: 'Erreur',\n                    text: first_name + ' est déjà Manager'\n                });\n            } else {\n                axios.patch('http://localhost:3000/api/users/' + id, {role: 'Manager'}, {\n                    headers: {\n                        Authorization: 'Bearer ' + localStorage.getItem('token')\n                    }   \n                })\n                .then((response) => {\n                    this.getUsersAndManagers();\n                    Swal.fire(\n                        'Félicitation!',\n                        first_name + ' est devenu(e) Manager',\n                        'success'\n                    )\n                })\n                .catch((error) => {\n                    console.log(error);\n                });\n            }\n            \n        },\n\n        // FOR MODAL TEAM ###############################################################\n\n        resetModal() {\n            this.teamName = '';\n            this.selected = null;\n        },\n\n        handleOk(bvModalEvt) {\n          // Prevent modal from closing\n          bvModalEvt.preventDefault()\n          // Trigger submit handler\n          this.handleSubmit()\n        },\n\n        handleSubmit() {\n\n            this.team = {\n                name: this.teamName,\n                managerId: this.managerId\n            }\n\n            axios.post('http://localhost:3000/api/teams', this.team, {\n                headers: {\n                    Authorization: 'Bearer ' + localStorage.getItem('token')\n                }\n            })\n            .then((response) => {\n                alert('Equipe créée avec succès');\n            })\n            .catch((error) => {\n                console.log(error);\n            });\n            this.$nextTick(() => {\n                this.$refs.modal.hide()\n            })\n        },\n        \n    }\n}\n",{"version":3,"sources":["UserManager.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"UserManager.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n    <div>\n        <b-button v-b-modal.add-team class=\"float-right\">Créer une équipe</b-button><br><br>\n        <b-modal id=\"add-team\" ref=\"modal\" title=\"Créer une équipe\" @show=\"resetModal\" @hidden=\"resetModal\" @ok=\"handleOk\">\n            <form ref=\"form\" @submit.stop.prevent=\"handleSubmit\">\n                <b-form-group label=\"Nom de l'équipe\" label-for=\"teamName\" invalid-feedback=\"Nom de l'équipe est obligatoire\">\n                    <b-form-input id=\"teamName\" v-model=\"teamName\" required></b-form-input>\n                </b-form-group>\n                <b-form-group label=\"Choisissez un employé\" invalid-feedback=\"Vous devez choisir un employé\">\n                    <b-form-select v-model=\"selected\">\n                        <option v-for=\"manager in managers\" :key=\"manager.id\" :value=\"manager.id\" v-on:click=\"selectedValue\">{{ manager.first_name }}</option>\n                    </b-form-select>\n                </b-form-group>\n            </form>\n        </b-modal>\n\n        <table class=\"table table-striped table-hover\">\n            <thead class=\"thead-dark\">\n                <tr>\n                <th scope=\"col\">Id</th>\n                <th scope=\"col\">Nom</th>\n                <th scope=\"col\">Prénom</th>\n                <th scope=\"col\">Email</th>\n                <th scope=\"col\">Role</th>\n                <th scope=\"col\">Options</th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr v-for=\"{id, last_name, first_name, email, role} in users\" :key=\"id\">\n                <td><b>{{ id }}</b></td>\n                <td><b>{{ last_name }}</b></td>\n                <td><b>{{ first_name }}</b></td>\n                <td><b>{{ email }}</b></td>\n                <td><b>{{ role }}</b></td>\n                <td><button v-on:click=\"promote(id, first_name, role)\">Promouvoir</button> | <button v-on:click=\"deleting(id)\">Supprimer</button></td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n</template>\n\n<script>\n\nimport axios from 'axios';\nimport Swal from 'sweetalert2';\n\nexport default {\n    name: 'UserManager',\n\n    data() {\n        return {\n            users: [],\n            managers: [],\n            token: localStorage.getItem('token'),\n            teamName: '',\n            selected: null,\n            managerId: null,\n            team: {\n                name: '',\n                managerId: 0\n            }\n        }\n    },\n\n    created() {\n        this.getUsersAndManagers();\n    },\n\n    methods: {\n\n        selectedValue(e) {\n            this.managerId = e.target.value;\n        },\n\n        getUsersAndManagers() {\n            axios.get('http://localhost:3000/api/users', {headers: {\n                Authorization: 'Bearer ' + this.token\n            }}).then((response) => {\n                // RETRIEVE USERS\n                this.users = response.data;\n                this.users.splice(0, 1);\n                this.total = this.users.length;\n\n                // RETRIEVE MANAGERS\n                for (var i = 0; i < this.users.length; i++) {\n                    if (this.users[i].role == 'Manager') {\n                        this.managers.push(this.users[i]);\n                    }\n                }\n            }).catch((error) => {\n                console.log(error);\n            });\n        },\n\n        deleting(id) {\n            Swal.fire({\n                title: 'Êtes vous sûr de vouloir supprimer cet utilisateur ?',\n                type: 'warning',\n                showCancelButton: true,\n                confirmButtonColor: '#3085d6',\n                cancelButtonColor: '#d33',\n                confirmButtonText: 'Oui supprimer'\n                }).then((result) => {\n                if (result.value) {\n                    axios.delete('http://localhost:3000/api/users/' + id, {\n                        headers: {\n                            Authorization: 'Bearer ' + localStorage.getItem('token')\n                        }\n                    }).then(response => {\n                        this.getUsers();\n                        Swal.fire(\n                            'Supprimé!',\n                            'success'\n                        )\n                    }).catch(err => {\n                        Swal.fire({\n                            type: 'error',\n                            title: 'Erreur',\n                            text: 'Suppression impossible'\n                        })\n                        console.log(err);\n                    });\n                }\n            })\n        },\n\n        promote(id, first_name, role) {\n            if (role == 'Manager') {\n                Swal.fire({\n                    type: 'error',\n                    title: 'Erreur',\n                    text: first_name + ' est déjà Manager'\n                });\n            } else {\n                axios.patch('http://localhost:3000/api/users/' + id, {role: 'Manager'}, {\n                    headers: {\n                        Authorization: 'Bearer ' + localStorage.getItem('token')\n                    }   \n                })\n                .then((response) => {\n                    this.getUsersAndManagers();\n                    Swal.fire(\n                        'Félicitation!',\n                        first_name + ' est devenu(e) Manager',\n                        'success'\n                    )\n                })\n                .catch((error) => {\n                    console.log(error);\n                });\n            }\n            \n        },\n\n        // FOR MODAL TEAM ###############################################################\n\n        resetModal() {\n            this.teamName = '';\n            this.selected = null;\n        },\n\n        handleOk(bvModalEvt) {\n          // Prevent modal from closing\n          bvModalEvt.preventDefault()\n          // Trigger submit handler\n          this.handleSubmit()\n        },\n\n        handleSubmit() {\n\n            this.team = {\n                name: this.teamName,\n                managerId: this.managerId\n            }\n\n            axios.post('http://localhost:3000/api/teams', this.team, {\n                headers: {\n                    Authorization: 'Bearer ' + localStorage.getItem('token')\n                }\n            })\n            .then((response) => {\n                alert('Equipe créée avec succès');\n            })\n            .catch((error) => {\n                console.log(error);\n            });\n            this.$nextTick(() => {\n                this.$refs.modal.hide()\n            })\n        },\n        \n    }\n}\n</script>\n"]}]}